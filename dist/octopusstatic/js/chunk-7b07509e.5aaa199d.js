(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b07509e"],{"293d":function(e,t,n){"use strict";n("aa86")},"6f29":function(e,t,n){"use strict";n.r(t);n("b0c0");var r=n("7a23"),o={class:"chat"},c={class:"title"},a=Object(r["createTextVNode"])("搜索"),s={key:0,class:"container"},i={class:"room-head"},l=["onClick"],u=["src"],m={class:"msg-item-content"},d={class:"nickName"},b={class:"time"},f={key:0,class:"content"},h={key:1,class:"content"},g=["src"],p={key:2,class:"content"};function O(e,t,n,O,v,j){var k=Object(r["resolveComponent"])("el-option"),N=Object(r["resolveComponent"])("el-select"),w=Object(r["resolveComponent"])("el-button");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",o,[Object(r["createElementVNode"])("div",c,[Object(r["createVNode"])(N,{modelValue:v.roomName,"onUpdate:modelValue":t[0]||(t[0]=function(e){return v.roomName=e}),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"搜索偶像","remote-method":j.remoteMethod,loading:v.loading},{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(v.searchArr,(function(e){return Object(r["openBlock"])(),Object(r["createBlock"])(k,{key:e.roomId,label:e.name,value:e.name},null,8,["label","value"])})),128))]})),_:1},8,["modelValue","remote-method","loading"]),Object(r["createVNode"])(w,{class:"title-btn",round:"",onClick:j.searchByName},{default:Object(r["withCtx"])((function(){return[a]})),_:1},8,["onClick"])]),"ONLINE"===v.stage?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",s,[Object(r["createElementVNode"])("div",i,Object(r["toDisplayString"])(v.showName),1),Object(r["createElementVNode"])("div",{class:"room-box",ref:"scroll-box",onScroll:t[2]||(t[2]=function(e){return j.scrollGet(e)})},[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(j.filterMsgs,(function(n){var o,c;return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",{key:n.idClient,onClick:function(e){return j.inspect(n)},class:"msg-item"},[Object(r["createElementVNode"])("img",{class:"avatar",src:v.base+(null===(o=n.custom.user)||void 0===o?void 0:o.avatar),alt:""},null,8,u),Object(r["createElementVNode"])("div",m,[Object(r["createElementVNode"])("span",d,Object(r["toDisplayString"])(null===(c=n.custom.user)||void 0===c?void 0:c.nickName),1),Object(r["createElementVNode"])("span",b,Object(r["toDisplayString"])(j.time(n.time)),1),"text"===n.type?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",f,Object(r["toDisplayString"])(n.custom.text),1)):"image"===n.type?(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",h,[Object(r["createElementVNode"])("img",{class:"content-img",src:n.file.url,onOnload:t[1]||(t[1]=function(t){return e.flag?"":j.toEnd})},null,40,g)])):(Object(r["openBlock"])(),Object(r["createElementBlock"])("div",p))])],8,l)})),128))],544)])):Object(r["createCommentVNode"])("",!0)])}var v=n("5530"),j=n("2909"),k=n("1da1"),N=(n("96cf"),n("4de4"),n("d3b7"),n("caad"),n("2532"),n("fb6a"),n("99af"),n("d81d"),n("e9c4"),n("ed08")),w={name:"Home",created:function(){},watch:{roomName:function(){var e=this,t=this.roomName.length;this.roomArr=this.dataPeople.filter((function(n){return""!==e.roomName&&(n.name.includes(e.roomName)||n.abbr.slice(0,t)===e.roomName)}))}},computed:{filterMsgs:function(){var e=this.msgs.filter((function(e){var t;return"DELETE"!==e.custom.messageType&&3===(null===(t=e.custom.user)||void 0===t?void 0:t.roleId)}));return e},time:function(){return function(e){return Object(N["a"])(e)}}},data:function(){return{base:"https://source.48.cn/",chatroom:null,stage:"OFFLINE",msgs:[],roomName:"",roomArr:[],searchArr:[],loading:!1,dataPeople:this.$store.state.dataPeople,showName:""}},methods:{init:function(e){var t=this,n="632feff1f4c838541ab75195d1ceb3fa",r=["chatweblink01.netease.im:443"],o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("e",t)},c=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.log("r",t)};this.chatroom=this.Nim.Chatroom.getInstance({appKey:n,isAnonymous:!0,chatroomNick:"RO",chatroomId:e,chatroomAddresses:r,onconnect:this.onconnect.bind(this),onwillreconnect:o,ondisconnect:function(){t.stage="OFFLINE"},onerror:c,onmsgs:this.onmsgs.bind(this)})},onconnect:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.stage="ONLINE",t.next=3,e.oneDayMsg();case 3:setTimeout((function(){e.toEnd()}),3e3);case 4:case"end":return t.stop()}}),t)})))()},onmsgs:function(e){this.msgs=[].concat(Object(j["a"])(this.msgs),Object(j["a"])(e.filter((function(e){return!e.resend})).map((function(e){return Object(v["a"])(Object(v["a"])({},e),{},{custom:JSON.parse(e.custom)})}))))},oneDayMsg:function(){var e=this;return Object(k["a"])(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.msgs[0]?new Date(e.msgs[0].time):new Date,r=!0,o=0;case 3:if(!r){t.next=17;break}return t.next=6,e.earlier();case 6:if(0!==e.msgs.length){t.next=9;break}return alert("该房间没有消息"),t.abrupt("break",17);case 9:if(!(new Date-n>=5e3)){t.next=11;break}return t.abrupt("break",17);case 11:if(console.log(new Date-n),o++,!(o>=5)){t.next=15;break}return t.abrupt("break",17);case 15:t.next=3;break;case 17:console.log(e.msgs);case 18:case"end":return t.stop()}}),t)})))()},earlier:function(){var e=this;return new Promise((function(t){var n;e.chatroom.getHistoryMsgs({timetag:null===(n=e.msgs[0])||void 0===n?void 0:n.time,done:function(n,r){if(n)console.log(n);else{var o=Object(j["a"])(r.msgs);o.reverse(),e.msgs=[].concat(Object(j["a"])(o.filter((function(e){return!e.resend})).map((function(e){return Object(v["a"])(Object(v["a"])({},e),{},{custom:JSON.parse(e.custom)})}))),Object(j["a"])(e.msgs)),t()}}})}))},inspect:function(e){console.log(JSON.parse(JSON.stringify(e)))},searchByName:function(){var e,t,n,r=null===(e=this.roomArr[0])||void 0===e?void 0:e.roomId;this.showName=null===(t=this.roomArr[0])||void 0===t?void 0:t.name,this.msgs=[],this.roomArr=[],this.roomName="",this.searchArr=[],null===(n=this.chatroom)||void 0===n||n.disconnect(),this.chatroom=null,this.init(r)},remoteMethod:function(e){var t=this;if(""!==e){this.loading=!0;var n=e.length;setTimeout((function(){t.loading=!1,t.searchArr=t.dataPeople.filter((function(t){return""!==e&&(t.name.includes(e)||t.abbr.slice(0,n)===e)}))}),200)}else this.searchArr=[]},toEnd:function(){var e=this;this.$nextTick((function(){var t=e.$refs["scroll-box"];t.scrollTop=t.scrollHeight}))},scrollGet:function(e){var t=this;return Object(k["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(0!==e.target.scrollTop){n.next=3;break}return n.next=3,t.earlier();case 3:case"end":return n.stop()}}),n)})))()}}},y=(n("293d"),n("6b0d")),E=n.n(y);const x=E()(w,[["render",O]]);t["default"]=x},aa86:function(e,t,n){},ed08:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n("53ca");n("ac1f"),n("00b4"),n("5319"),n("4d63"),n("c607"),n("2c3e"),n("25f0"),n("d3b7"),n("4d90");function o(e,t){if(0===arguments.length||!e)return null;var n,o=t||"{y}-{m}-{d} {h}:{i}:{s}";"object"===Object(r["a"])(e)?n=e:("string"===typeof e&&(e=/^[0-9]+$/.test(e)?parseInt(e):e.replace(new RegExp(/-/gm),"/")),"number"===typeof e&&10===e.toString().length&&(e*=1e3),n=new Date(e));var c={y:n.getFullYear(),m:n.getMonth()+1,d:n.getDate(),h:n.getHours(),i:n.getMinutes(),s:n.getSeconds(),a:n.getDay()},a=o.replace(/{([ymdhisa])+}/g,(function(e,t){var n=c[t];return"a"===t?["日","一","二","三","四","五","六"][n]:n.toString().padStart(2,"0")}));return a}}}]);